#!/bin/bash
# Optional pre-commit hook for local index regeneration
# To install: bash scripts/install-hooks.sh
#
# This hook regenerates the index locally when dish files are changed,
# but does NOT commit the index (it's gitignored and managed by CI).
# This is purely for local preview.

# Check if any dish files are staged
if git diff --cached --name-only | grep -q "data/food-data-bank/.*\.md"; then
    echo "üîÑ Food bank files changed, regenerating index for local preview..."

    # Get to repo root
    cd "$(git rev-parse --show-toplevel)" || exit 1

    if python3 scripts/generate_index.py; then
        echo "‚úÖ Index regenerated successfully (local preview only)"
        echo "‚ÑπÔ∏è  Index is NOT committed (gitignored, managed by CI)"
    else
        echo "‚ùå Failed to regenerate index"
        exit 1
    fi
fi

# Prevent accidental commits of the gitignored index file
if git diff --cached --name-only | grep -q "^data/food-data-bank-index.md$"; then
    echo "‚ùå Error: Cannot commit data/food-data-bank-index.md (managed by CI)"
    echo ""
    echo "This file is in .gitignore and should not be committed."
    echo "Remove it from staging with:"
    echo "  git reset HEAD data/food-data-bank-index.md"
    echo ""
    exit 1
fi

exit 0
